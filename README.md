# K3s í´ëŸ¬ìŠ¤í„° ì„¤ì • ìŠ¤í¬ë¦½íŠ¸

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
k3s-cluster/
â”œâ”€â”€ 01-install-master.sh     # ë§ˆìŠ¤í„° ë…¸ë“œ ì„¤ì¹˜ (ì´ ì„œë²„)
â”œâ”€â”€ 02-add-worker.sh         # Worker ë…¸ë“œ ì¶”ê°€ (ë‹¤ë¥¸ ì„œë²„)
â”œâ”€â”€ 03-add-master-ha.sh      # HA ë§ˆìŠ¤í„° ì¶”ê°€ (ë‹¤ë¥¸ ì„œë²„)
â”œâ”€â”€ 04-node-labels.sh        # ë…¸ë“œ ë¼ë²¨/í…Œì¸íŠ¸ ê´€ë¦¬
â”œâ”€â”€ 05-setup-nvidia-gpu.sh   # NVIDIA GPU ì§€ì› ì„¤ì •
â”œâ”€â”€ 99-uninstall.sh          # K3s ì™„ì „ ì‚­ì œ
â”œâ”€â”€ tokens/                  # ë…¸ë“œ ì¡°ì¸ í† í° (ì„¤ì¹˜ í›„ ìƒì„±)
â””â”€â”€ README.md
```

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1ë‹¨ê³„: ë§ˆìŠ¤í„° ë…¸ë“œ ì„¤ì¹˜ (ì´ ì„œë²„)

```bash
cd /home/saiadmin/k3s-cluster
sudo ./01-install-master.sh
```

### 2ë‹¨ê³„: Worker ë…¸ë“œ ì¶”ê°€ (ë‹¤ë¥¸ ì„œë²„ì—ì„œ)

ë§ˆìŠ¤í„° ì„¤ì¹˜ í›„ í† í° í™•ì¸:
```bash
cat /home/saiadmin/k3s-cluster/tokens/node-token
```

ë‹¤ë¥¸ ì„œë²„ì—ì„œ ì‹¤í–‰:
```bash
# ìŠ¤í¬ë¦½íŠ¸ ë³µì‚¬ ë˜ëŠ” curlë¡œ ê°€ì ¸ì˜¤ê¸°
sudo ./02-add-worker.sh \
    --master-ip 14.32.100.220 \
    --token <í† í°> \
    --type gpu \
    --gpu-type rtx4090 \
    --gpu-count 2
```

## ğŸ“‹ ë…¸ë“œ íƒ€ì…

| íƒ€ì… | ìš©ë„ | ë¼ë²¨ |
|------|------|------|
| `cpu` | CPU ì—°ì‚° ì „ìš© | `node-type=cpu`, `cpu-optimized=true` |
| `gpu` | GPU ì›Œí¬ë¡œë“œ | `node-type=gpu`, `gpu=true`, `gpu-type=<íƒ€ì…>` |
| `storage` | ìŠ¤í† ë¦¬ì§€ ì „ìš© | `node-type=storage`, `storage=true` |
| `general` | ë²”ìš© | `node-type=general` |

## ğŸ”§ ë…¸ë“œ ê´€ë¦¬

### ë¼ë²¨ í™•ì¸
```bash
./04-node-labels.sh list
```

### GPU ë…¸ë“œ ë¼ë²¨ ì„¤ì •
```bash
./04-node-labels.sh label-gpu <ë…¸ë“œëª…> --gpu-type rtx3090 --gpu-count 4
```

### GPU ì „ìš© í…Œì¸íŠ¸ ì„¤ì • (ì„ íƒ)
```bash
# GPU ë…¸ë“œì— GPU ì›Œí¬ë¡œë“œë§Œ ìŠ¤ì¼€ì¤„ë§
./04-node-labels.sh taint-gpu <ë…¸ë“œëª…>
```

## ğŸ® GPU ì§€ì› ì„¤ì •

ë§ˆìŠ¤í„° ì„¤ì¹˜ í›„ GPU ì§€ì› í™œì„±í™”:
```bash
sudo ./05-setup-nvidia-gpu.sh
```

GPU í…ŒìŠ¤íŠ¸:
```bash
kubectl run gpu-test --rm -it --restart=Never \
    --image=nvcr.io/nvidia/cuda:12.0.0-base-ubuntu22.04 \
    --limits=nvidia.com/gpu=1 -- nvidia-smi
```

## ğŸ”„ HA í™•ì¥

ë‹¨ì¼ ë§ˆìŠ¤í„°ì—ì„œ HAë¡œ í™•ì¥ (ë§ˆìŠ¤í„° 2, 3ë²ˆ ì„œë²„ì—ì„œ):
```bash
sudo ./03-add-master-ha.sh \
    --master-ip 14.32.100.220 \
    --token <í† í°>
```

**ê¶Œì¥**: ë§ˆìŠ¤í„° ë…¸ë“œ 3ëŒ€ ì´ìƒ

## ğŸ“ ì˜ˆì‹œ: í´ëŸ¬ìŠ¤í„° êµ¬ì„±

```
í´ëŸ¬ìŠ¤í„° êµ¬ì„± ì˜ˆì‹œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      K3s í´ëŸ¬ìŠ¤í„°                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Master (HA)                                                â”‚
â”‚  â”œâ”€ master-01 (14.32.100.220) - GPU: RTX3090 x4            â”‚
â”‚  â”œâ”€ master-02 (10.0.0.2)                                   â”‚
â”‚  â””â”€ master-03 (10.0.0.3)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Worker Nodes                                               â”‚
â”‚  â”œâ”€ gpu-worker-01     - GPU: RTX4090 x2                    â”‚
â”‚  â”œâ”€ gpu-worker-02     - GPU: A100 x8                       â”‚
â”‚  â”œâ”€ cpu-worker-01     - CPU ì „ìš©                           â”‚
â”‚  â”œâ”€ cpu-worker-02     - CPU ì „ìš©                           â”‚
â”‚  â””â”€ storage-worker-01 - NVMe ìŠ¤í† ë¦¬ì§€                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ë°©í™”ë²½**: 6443 (API), 10250 (kubelet), 2379-2380 (etcd) í¬íŠ¸ ê°œë°© í•„ìš”
2. **ìŠ¤ì™‘**: ìë™ìœ¼ë¡œ ë¹„í™œì„±í™”ë¨
3. **í† í° ë³´ì•ˆ**: `tokens/` ë””ë ‰í† ë¦¬ ì ‘ê·¼ ì œí•œ ê¶Œì¥

## ğŸ—‘ï¸ ì‚­ì œ

```bash
sudo ./99-uninstall.sh
```
